<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=DotGothic16&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./style.css">
  <title>money tree</title>
</head>

<body>
  <div id="game">
    <img src="./images/tree2.png" id="img" class="tree">
    <div id="btn-start">PLAY</div>

    <div id="record">
      <div id="one">
        $<span id="one-score">0</span>
      </div>
      <div id="five">
        $ <span id="five-score">0</span>
      </div>
      <div id="ten">
        $<span id="ten-score">0</span>
      </div>
    </div>
    <span id="text-time">00</span>

    <div id="zone"></div>
  </div>

  <audio id="money" src="./money.mp3"></audio>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js'
    integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=='
    crossorigin='anonymous'></script>
  <script>
    let oneScore = 0
    let fiveScore = 0
    let tenScore = 0
    let time = 0

    // 紀錄表先藏起來
    $('#record').hide()

    // 點擊開始
    $('#btn-start').click(() => {

      //  開始按鈕淡出
      $('#btn-start').fadeToggle()
      // 淡入圖片沒字版
      $('#img').fadeIn(2000, () => {
        $('#img').attr('src', `./images/tree3.png`)
      })
      // 淡入記錄框
      $('#record').fadeIn()

      //重設百鈔分數
      oneScore = 0
      // 重設五百分數
      fiveScore = 0
      // 重設千鈔分數
      tenScore = 0
      $('#one-score').text(oneScore)
      $('#five-score').text(fiveScore)
      $('#ten-score').text(tenScore)

      // 重設秒數
      time = 20
      $('#text-time').text(time)

      // 因為 setInterval 裡的 this 會指向 window，而不是點到的按鈕，所以先把 this 存起來
      const_this = this

      timer = setInterval(function () {
        time--
        // 開始倒數
        $('#text-time').text(time)
        // 倒數秒數小於10，十位數補零
        const Time = time.toString().padStart(2, '0');
        $('#text-time').text(Time);

        // 隨機1~10
        // ceil :無條件進位
        const random = Math.ceil(Math.random() * 10)

        // 產生國父的機率
        if (random > 1 && $('.father').length < 20) {
          // round:四捨五入
          const top = Math.round(Math.random() * 100) + '%'
          const left = Math.round(Math.random() * 100) + '%'
          const father = $(`<img src='./images/father.png' class=father style='top:${top};left:${left};transform:translate(-${left},-${top});'>`)

          $('#zone').append(father)
        }

        // 產生boy的機率
        if (random > 5 && $('.boy').length < 5) {
          const top = Math.round(Math.random() * 100) + '%'
          const left = Math.round(Math.random() * 100) + '%'

          const boy = $(`<img src='./images/boy.png' class=boy style='top:${top};left:${left};transform:translate(-${left},-${top});'>`)
          $('#zone').append(boy)
        }

        // 產生鳥的機率
        if (random > 3 && $('.bird').length < 5) {
          const top = Math.round(Math.random() * 100) + '%'
          const left = Math.round(Math.random() * 100) + '%'
          const bird = $(`<img src='./images/bird.png' class=bird style='top:${top};left:${left};transform:translate(-${left},-${top});'>`)
          $('#zone').append(bird)
          moveBird(bird)
        }


        if (time === 0) {
          //  停止倒數
          clearInterval(timer)
          // 清空所有子元素
          $('#zone').empty()
          // 記錄區消失
          $('#record').fadeToggle()
          // 樹變有字版
          $('#img').fadeIn(2000, () => {
            $('#img').attr('src', `./images/tree2.png`)
          })
          // 開始按鈕出現
          $('#btn-start').fadeIn()

        }
      }, 1000)

    })

    $('#zone').on('click', '.boy ,.father, .bird', function () {
      // tree搖動
      $('#img').addClass('shake')
      setTimeout(function () {
        $('#img').removeClass('shake')
      }, 500)

      // 播放音效
      moneySound()

      // 點擊國父圖片
      if ($(this).hasClass('father')) {
        // 讓分數圖片出現在底部位置
        const top = Math.round(Math.random() * (95 - 80) + 80) + '%'
        const left = Math.round(Math.random() * 100) + '%'
        const score1 = $(`<img src='./images/score1.png' class=score1 style='top:${top};left:${left};transform:translate(-${left},-${top});'>`)

        // 國父圖片淡出且移除
        $(this).fadeToggle().remove()
        oneScore += 100
        $('#one-score').text(oneScore)

        // 新增100分數圖片
        $('#zone').append(score1)
        score1.animate({
          top: "10%"
        }, 500).fadeToggle()

        // 點擊鳥圖片
      } else if ($(this).hasClass('bird')) {
        $(this).stop()
        $(this).attr('src', 'images/score3.png').fadeOut()

        tenScore += 1000
        $('#ten-score').text(tenScore)

        // 點擊男孩
      } else if ($(this).hasClass('boy')) {
        //  讓分數圖片出現在底部位置
        const top = Math.round(Math.random() * (95 - 80) + 80) + '%'
        const left = Math.round(Math.random() * 100) + '%'
        const score2 = $(`<img src='./images/score2.png' class=score2 style='top:${top};left:${left};transform:translate(-${left},-${top});'>`)

        // 圖片淡出且移除
        $(this).fadeToggle().remove()
        fiveScore += 500
        $('#five-score').text(fiveScore)

        // 新增500分數圖片
        $('#zone').append(score2)

        score2.animate({
          top: "20%"
        }, 600).fadeToggle()


      }
    })




    //鳥移動效果
    function moveBird(bird) {
      const left = Math.round(Math.random() * 100) + '%'
      const top = Math.round(Math.random() * 100) + '%'
      bird.animate({ top: top, left: left }, 2000, function () {
        moveBird(bird)
      })
    }

    // 音效
    function moneySound() {
      var money = new Audio('./money.mp3')
      money.play()
      setTimeout(function () {
        money.pause()
        money.currentTime = 0 // 将音效的播放位置重置为0，以便下次播放时从头开始
      }, 2000)
    }


  </script>
</body>

</html>